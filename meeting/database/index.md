# mysql45讲
## mysql的框架有几个组件，各是什么作用
mysql的框架有连接器、分析器、优化器、执行器和存储引擎。
连接器负责客户端与服务器之间的连接
分析器负责分析语句是否正确, 语法分析，词法分析。
优化器是对相应的sql语句进行优化，选择效率最高的方式去执行,选择索引。
执行器首先判断是否对表有相应的执行权限，若有的话开始执行,并返回结果。
存储引擎负责存储数据，提供读写接口.

## mysql中的索引
### 为什么会有索引
索引的出现是为了提高数据查询的效率
索引大大减少了服务器需要扫描的数据量
索引可以将随机io变为顺序io.
顺序io指的是读写操作的访问地址连续，即读写磁头可以以最小的移动访问下一个块。而随机io访问地址不连续，随机分布在磁盘的地址空间。
### 为什么会使用B+树来作为索引的数据结构。
实现索引常见的数据结构，哈希表、有序数组与搜索树。
哈希表只适用于等值查询，因为一个连续的索引在经过哈希函数之后不一定连续。所以哈希表不适用于范围查询。
有序数组在范围查询上表现良好，但更新数据较为麻烦，因此，有序数组索引只适合静态存储引擎，这类不会再修改的数据。
为什么不使用二叉树呢？因为二叉树的树高较高，所以一次查询可能要访问多个数据块，由于mysql索引的根节点在内存中(buffer pool)，而其余的节点都在磁盘中，因此一次查询可能要读多次磁盘，所以不应该使用二叉树。
B树中子节点的数量一般在上千。
B树的key分布在整棵树中，每个节点既包含key,也包含data.
因此，B树的搜索可能在非叶节点结束，最好O(1)就能找到数据.
而B树的data值只存储在叶子节点，非叶子节点(内部节点)中只有key.
且B+树之间叶子节点中存在着一个双向指针，从而能够更好的支持范围查询。
并且在B+树中，内部节点无data值，因此B+树单次IO的信息量大于B树，因此B+树相对于B树来说磁盘I/O的数目更少。

### 索引的分类
根据叶子节点的内容，可以将索引分为主键索引和非主键索引
主键索引叶子节点存放的是整行数据，在InnoDB中，也被称为聚簇索引；
非主键索引叶子节点存放的是主键值，在InnoDB中，被称为二级索引。
覆盖索引指的是在非主键索引树上可以直接获取查询结果，不需要经过回表，该索引已经满足了我们的查询需求，因此称为覆盖索引。

### 索引的维护
采用业务逻辑的字段做主键，不易保证有序插入，会造成索引列的分裂和合并，造成写数据成本较高，因此，为了保证有序插入，采用自增主键是较好的选择。 

而在典型的KV场景下（只有一个索引，该索引必须是唯一索引），则适合使用业务逻辑的字段来作为索引。

### 索引的优化
1.使用覆盖索引，即建立一个联合索引, 如将身份证号和姓名建立联合索引。联合索引的key是身份证号和姓名，value是主键值。
2.最左前缀原则，建立联合索引时，需要考虑联合索引中的顺序，尽量少维护一个索引，若做不到少维护一个索引，则更多考虑节省空间。
3.索引下推，指的是在查询时，可以在二级索引的遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，从而减少回表次数。
